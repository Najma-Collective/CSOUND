# Testing and Quality Assurance Guide

This repository includes helper scripts and documentation for validating the `nala_sinephro_ambient.csd` composition. The process covers syntax verification, full audio rendering, automated asset checks, and options for isolating instruments during focused listening sessions.

## Prerequisites

1. **Csound runtime** – install via your package manager (for example `apt-get install csound`) or from the [official downloads](https://csound.com/download.html).
2. **Python 3 with the standard library** – used by the validation helper for reading metadata from rendered WAV files. No external packages are required.

Once installed you can confirm availability with:

```bash
csound --version
python3 --version
```

## Directory layout

- `scripts/` – automation helpers (`run_syntax_check.sh`, `render_and_validate.sh`).
- `logs/` – timestamped execution logs generated by the scripts for long-term QA records.
- `build/` – default location for rendered WAV files (git-ignored).

## Required verification steps

### 1. Syntax check (`csound -c`)

Run the helper script to capture a syntax-only pass:

```bash
./scripts/run_syntax_check.sh nala_sinephro_ambient.csd
```

The script prints and stores the output from `csound -c` in `logs/syntax_check_<timestamp>.log`. You can also run the underlying command manually if preferred:

```bash
csound -c nala_sinephro_ambient.csd
```

### 2. Full render (`csound -o output.wav`)

Render the full mix and validate the generated WAV file:

```bash
./scripts/render_and_validate.sh nala_sinephro_ambient.csd build/nala_full_mix.wav
```

The script performs the following steps:

1. Executes `csound -d -o build/nala_full_mix.wav nala_sinephro_ambient.csd`.
2. Calculates duration, channel count, sample rate, and peak amplitude using the Python `wave` and `audioop` modules.
3. Fails fast if any metric falls outside the default thresholds (48000 Hz sample rate, 2 channels, 60 s ± 2 s duration, peak ≤ 0.8 ± 0.05 full scale).
4. Records the complete transcript in `logs/render_<timestamp>.log`.

If you need to override expectations (for example when auditioning a truncated score), export environment variables before running the script:

```bash
EXPECTED_DURATION=32 DURATION_TOLERANCE=0.5 ./scripts/render_and_validate.sh custom.csd build/short_take.wav
```

### 3. Analysis review

Inspect the generated log in `logs/` to ensure the metadata summary aligns with expectations. Archive the log alongside the rendered WAV when sharing QA packages.

## Instrument isolation workflow

Component-level listening is helpful when diagnosing orchestration details. Two approaches work well with the provided assets:

1. **Temporary score edits** – duplicate the composition and comment out the `i` statements for instruments you wish to mute. For example, to audition only Instrument 2:
   - Copy the file: `cp nala_sinephro_ambient.csd nala_sinephro_ambient_pad_only.csd`.
   - In the `<CsScore>` section of the copy, comment out or delete the `i1`, `i3`, and `i4` lines, leaving only the `i2` event.
   - Run `./scripts/render_and_validate.sh nala_sinephro_ambient_pad_only.csd build/pad_only.wav`.

2. **Variant score files** – maintain dedicated `.csd` variants per instrument or stem grouping in a `variants/` folder. Each variant keeps the same `<CsInstruments>` definitions but contains only the relevant `i` score events. Render and validate each variant with the same script to ensure timing consistency before layering stems in a DAW.

When using either method, keep the helper scripts in place to guarantee consistent sample rate, duration, and peak levels across the full mix and isolated stems. Store the resulting render logs in `logs/` (renaming them to indicate the variant, if helpful) so future reviewers can trace which take produced which audio file.

## Log retention and QA hand-off

All script runs generate timestamped logs. Include these log files when handing off QA bundles so reviewers can confirm:

- Syntax checks were executed without errors.
- Rendering completed successfully with the expected audio metadata.
- Any deviations from baseline expectations (e.g., shorter excerpts) were intentional and documented via environment variable overrides noted in the logs.

By following the steps above, contributors can consistently validate both the master mix and instrument-focused variations of the composition.
